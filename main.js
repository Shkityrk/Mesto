(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{L:()=>T});var t=function(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(r.inactiveButtonClass):t.classList.add(r.inactiveButtonClass)},r=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)},n=function(e){document.removeEventListener("keydown",c),e.classList.remove("popup_is-opened")},o=function(e){n(e.target)};function c(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");n(t)}}var a,u=document.querySelector("#card-template").content.querySelector(".card"),i=function(e,t){var r=u.cloneNode(!0),n=r.querySelector(t.cardImage),o=r.querySelector(t.cardLikes),c=r.querySelector(t.cardLikeButton),a=r.querySelector(t.cardDeleteButton);r.querySelector(t.cardTitle).textContent=e.name,n.src=e.link,n.alt=e.name,o.textContent=e.likes.length,e.owner._id!=l._id&&(a.style.display="none");var i=!1;return e.likes.some((function(e){return e._id===l._id}))&&(i=!0,c.classList.add(t.cardLikeButtonActive)),c.addEventListener("click",(function(r){i?(r.target.classList.remove(t.cardLikeButtonActive),_(e._id,o)):(r.target.classList.add(t.cardLikeButtonActive),f(e._id,o)),i=!i})),a.addEventListener("click",(function(t){m(e._id,t.target)})),n.addEventListener("click",(function(e){T(n.src,r.querySelector(t.cardTitle).textContent)})),r},s={baseUrl:"https://nomoreparties.co/v1/frontend-st-cohort-201",headers:{authorization:"f3fe2d94-a1e6-48eb-96e3-6b335f937148","Content-Type":"application/json"}},l={name:"",about:"",avatar:"",_id:"",cohort:""},d=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранить";e.textContent=t?r:n},p=function(e){e.querySelectorAll("input").forEach((function(e){e.value=""}))},f=function(e,t){fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:s.headers}).then((function(e){return 200===e.status?e.json():Promise.reject(e.status)})).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.error("Error: "+e)}))},_=function(e,t){fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:s.headers}).then((function(e){return 200===e.status?e.json():Promise.reject(e.status)})).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.error("Error: "+e)}))},m=function(e,t){fetch("".concat(s.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:s.headers}).then((function(e){return 200===e.status?e.json():Promise.reject(e.status)})).then((function(){t.closest(".card").remove()})).catch((function(e){console.error("Error: "+e)}))},y=document.querySelector(".places__list"),h=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),b=document.querySelector(".popup_type_avatar"),q=[S,h,v,b],E=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__image"),g=document.querySelectorAll(".popup__close"),C=h.querySelector(".popup__input_type_name"),j=h.querySelector(".popup__input_type_description"),P=v.querySelector(".popup__input_type_card-name"),x=v.querySelector(".popup__input_type_url"),A=b.querySelector(".popup__input_type_url"),B={cardImage:".card__image",cardTitle:".card__title",cardLikeButton:".card__like-button",cardLikeButtonActive:"card__like-button_is-active",cardDeleteButton:".card__delete-button",cardLikes:".card__likes-num",card:".card"},T=function(e,t){document.querySelector(".popup__image").src=e,document.querySelector(".popup__caption").textContent=t,r(S)};!function(e,t){fetch("".concat(s.baseUrl,"/users/me"),{method:"GET",headers:s.headers}).then((function(e){return 200===e.status?e.json():Promise.reject(e.status)})).then((function(r){l.name=r.name,l.about=r.about,l.avatar=r.avatar,l._id=r._id,l.cohort=r.cohort,document.querySelector(".profile__title").textContent=l.name,document.querySelector(".profile__description").textContent=l.about,document.querySelector(".profile__image").style.backgroundImage='url("'.concat(l.avatar,'")'),function(e,t){fetch("".concat(s.baseUrl,"/cards"),{method:"GET",headers:s.headers}).then((function(e){return 200===e.status?e.json():Promise.reject(e.status)})).then((function(r){r.forEach((function(r){e.append(i(r,t))})),console.log("cards loaded")})).catch((function(e){console.error("Error: "+e)}))}(e,t)})).catch((function(e){console.error("Error: "+e)}))}(y,B),a={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(a.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,r){var n=Array.from(e.querySelectorAll(r.inputSelector)),o=e.querySelector(r.submitButtonSelector);t(n,o,r),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,r){t.validity.valid?function(e,t,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""}(e,t,r):function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)}(e,t,t.validationMessage,r)}(e,c,r),t(n,o,r)}))}))}(e,a)})),E.addEventListener("click",(function(){C.value=document.querySelector(".profile__title").textContent,j.value=document.querySelector(".profile__description").textContent,r(h)})),L.addEventListener("click",(function(){return r(v)})),k.addEventListener("click",(function(){return r(b)})),g.forEach((function(e){e.addEventListener("click",(function(){var t=e.closest(".popup");n(t)}))})),q.forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("click",o)})),document.forms.editProfile.addEventListener("submit",(function(e){var t,r,o,c;e.preventDefault(),t=C.value,r=j.value,c=(o=h).querySelector(".button"),d(c,!0),fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:t,about:r})}).then((function(e){return 200===e.status?e.json():Promise.reject(e.status)})).then((function(e){l.name=e.name,l.about=e.about,document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about,n(o),p(o)})).catch((function(e){console.error("Error: "+e)})).finally((function(){d(c,!1)}))})),document.forms.newPlace.addEventListener("submit",(function(e){e.preventDefault(),function(e,t,r,o,c){var a=c.querySelector(".button");d(a,!0),fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return 200===e.status?e.json():Promise.reject(e.status)})).then((function(e){console.log(e),r.prepend(i(e,o)),n(c),p(c)})).catch((function(e){console.error("Error: "+e)})).finally((function(){d(a,!1)}))}(P.value,x.value,y,B,v)})),document.forms.editAvatar.addEventListener("submit",(function(e){var t,r,o;e.preventDefault(),t=A.value,o=(r=b).querySelector(".button"),d(o,!0),fetch("".concat(s.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:t})}).then((function(e){return 200===e.status?e.json():Promise.reject(e.status)})).then((function(e){document.querySelector(".profile__image").style.backgroundImage='url("'.concat(e.avatar,'")'),n(r),p(r)})).catch((function(e){console.error("Error: "+e)})).finally((function(){d(o,!1)}))}))})();